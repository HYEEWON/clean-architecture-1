# Ch3. 코드 구성

## 목차
* [계층으로 구성](#계층으로-구성)
* [기능으로 구성](#기능으로-구성)
* [육각형 아키텍처에 맞는 구조](#육각형-아키텍처에-맞는-구조)
* [의존성 주입](#의존성-주입)

<br>

## 계층으로 구성

```
package
  ㄴ domain
      ㄴ xx
      ㄴ xxService
      ㄴ xxRepository
  ㄴ persistence
      ㄴ xxRepositoryImpl
  ㄴ web
      ㄴ xxController
```

* 웹 계층, 도메인 계층, 영속성 계층 각각의 전용 패키지로 구성
* 의존성이 `domain` 패키지에 있는 도메인 코드로 향함
  * `persistence`에 `Impl`을 두어 의존성을 역전시킴

#### 단점

> 애플리케이션의 기능/특성을 구분 짓는 패키지 경계가 없음 <br>
* 관련없는 여러 기능이 한 패키지 안에서 섞일 수 있음

> 애플리케이션이 어떤 유스케이스를 제공하는지 파악할 수 없음 <br>
* 추측하고 직접 찾아야 함

> 패키지 구조를 통해 아키텍처를 파악할 수 없음 <br>
* 어댑터가 어떤 기능을 제공하는지 한 눈에 파악하기 어려움
* 포트를 파악할 수 없음

<br>

## 기능으로 구성

```
package
  ㄴ xx
      ㄴ xx
      ㄴ xxController
      ㄴ DoxxService
      ㄴ xxRepository
      ㄴ xxRepositoryImpl
```

* 클레스에 `defalt (package-private)` 접근 수준을 적용 -> 패키지 간의 경계 강화, 불필요한 의존성 방지
* `Service` 이름을 구체적으로 변경 -> 유스케이스를 쉽게 찾을 수 있음

#### 단점

> 아키텍처의 가시성이 낮아짐  <br>
* 패키지 명에서 무엇이 어댑터인지 알 수 없음
* 포트를 파악할 수 없음
* `defalt (package-private)`를 이용해도 도메인이 실수로 영속성에 의존하는 것을 막을 수 없음

<br>

## 육각형 아키텍처에 맞는 구조

* 핵심 요소: 엔티티, 유스케이스, 인커밍(주도하는)/아웃고잉(주도되는) 포트/어댑터

```
package
  ㄴ xx
      ㄴ adapter
          ㄴ in
              ㄴ web
                ㄴ xxController
          ㄴ out
              ㄴ persistence
                  ㄴ xxAdapter
                  ㄴ xxRepository
      ㄴ domain
          ㄴ xx
      ㄴ application
        ㄴ DoxxService
        ㄴ port
            ㄴ in
                ㄴ DoxxUseCase
            ㄴ out
                ㄴ xxPort
```

#### 어댑터 패키지

* 인커밍 어댑터 (애플리케이션 계층의 인커밍 포트 호출) + 아웃고잉 어댑터 (애플리케이션 계층의 아웃고잉 포트 구현)

> `defalt (package-private)` 접근 수준 가능 <br>
* 애플리케이션 계층에서 어댑터 클래스로 향하는 의존성은 없음
* 애플리케이션 패키지의 포트(인터페이스) 없이 외부에서 호출되지 않음

#### 애플리케이션 패키지

* 서비스는 인커밍 포트를 구현, 아웃고잉 포트(영속성 포트에 의해 구현)를 사용

> 어댑터에서 접근해야 하는 포트는 `public` 접근 수준을 사용해야 함 <br>
* 서비스는 인커밍 포트에 숨겨질 수 있어 `public`이 아니어도 됨

#### 도메인 패키지

> 어댑터와 서비스에서 접근할 수 있도록 `public` 접근 수준을 사용해야 함

#### 장점

> 어댑터를 다른 구현으로 쉽게 교체할 수 있음 <br>
* (ex) DB를 교체하는 경우, 관련 아웃고잉 포트만 어댑터에 구현하면 됨

> DDD 개념에 대응 가능

<br>

## 의존성 주입

* 애플리케이션 계층이 인커밍/아웃고잉 어댑터에 의존성을 갖지 않는 것이 중요함
* 영속성 어댑터와 같이 `아웃고잉 어댑터는 의존성 역전 원칙을 활용`해야 함
  * 애플리케이션 계층에 `인터페이스(포트)`를 만들고 어댑터에 해당 인터페이스를 구현한 클래스를 두면 됨
* `포트 인터페이스를 구현한 실제 객체`를 애플리케이션 계층에 제공하는 것은 `의존성 주입`을 활용

<img src="https://github.com/HYEEWON/clean-architecture-1/assets/38900338/5f44a970-c294-49bd-9125-cc8244d275d9" height="210px">
