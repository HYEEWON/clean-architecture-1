# 6. μμ†μ„± μ–΄λ‘ν„° κµ¬ν„ν•κΈ°

## λ©μ°¨
* [μμ΅΄μ„± μ—­μ „](#μμ΅΄μ„±-μ—­μ „)
* [μμ†μ„± μ–΄λ‘ν„°μ μ±…μ„](#μμ†μ„±-μ–΄λ‘ν„°μ-μ±…μ„)
* [ν¬νΈ μΈν„°νμ΄μ¤ λ‚λ„κΈ°](#ν¬νΈ-μΈν„°νμ΄μ¤-λ‚λ„κΈ°)
* [μμ†μ„± μ–΄λ‘ν„° λ‚λ„κΈ°](#μμ†μ„±-μ–΄λ‘ν„°-λ‚λ„κΈ°)
* [μ¤ν”„λ§ λ°μ΄ν„° JPA μμ ](#μ¤ν”„λ§-λ°μ΄ν„°-jpa-μμ )
* [λ°μ΄ν„°λ² μ΄μ¤ νΈλμ­μ…μ€ μ–΄λ–»κ² ν•΄μ•Ό ν• κΉ?](#λ°μ΄ν„°λ² μ΄μ¤-νΈλμ­μ…μ€-μ–΄λ–»κ²-ν•΄μ•Ό-ν• κΉ)

<br>

## μμ΅΄μ„± μ—­μ „

<img src="https://github.com/HYEEWON/clean-architecture-1/assets/38900338/0f4a6e40-02fa-486b-ba1e-d3af670e5a38" height="120px">

* μ• ν”λ¦¬μΌ€μ΄μ… μ„λΉ„μ¤λ” `ν¬νΈ μΈν„°νμ΄μ¤` νΈμ¶
* ν¬νΈλ” μ‹¤μ λ΅ μμ†μ„± μ‘μ—…μ„ μν–‰ν•κ³  DBμ™€ ν†µμ‹ ν•λ” μ±…μ„μ„ κ°€μ§„ `μμ†μ„± μ–΄λ‘ν„°` ν΄λμ¤μ— μν•΄ κµ¬ν„λ¨
* `μμ†μ„± μ–΄λ‘ν„°`: `μ£Όλ„λλ”` λλ” `μ•„μ›ƒκ³ μ‰` μ–΄λ‘ν„°
  * μ• ν”λ¦¬μΌ€μ΄μ…μ— μν•΄ νΈμ¶λ¨, μ• ν”λ¦¬μΌ€μ΄μ…μ„ νΈμ¶ν•μ§€ μ•μ
* ν¬νΈ: λ„λ©”μΈ μ½”λ“μ—μ„ μμ†μ„± κ³„μΈµμ— λ€ν• μμ΅΄μ„±μ„ μ—†μ• κΈ° μ„ν• κ°„μ ‘ κ³„μΈµ

<br>

## μμ†μ„± μ–΄λ‘ν„°μ μ±…μ„

```
1. μ…λ ¥μ„ λ°›μ
2. μ…λ ¥μ„ DB ν¬λ§·μΌλ΅ λ§¤ν•‘
3. μ…λ ¥μ„ DBλ΅ λ³΄λƒ„
4. DB μ¶λ ¥μ„ μ• ν”λ¦¬μΌ€μ΄μ… ν¬λ§·μΌλ΅ λ§¤ν•‘
5. μ¶λ ¥ λ°ν™
```

* 1: μμ†μ„± μ–΄λ‘ν„°λ” `ν¬νΈ μΈν„°νμ΄μ¤`λ¥Ό ν†µν•΄ μ…λ ¥μ„ λ°›μ
  * μ…λ ¥ λ¨λΈ: μΈν„°νμ΄μ¤κ°€ μ§€μ •ν• λ„λ©”μΈ μ—”ν‹°ν‹°, DB μ—°μ‚° μ „μ© κ°μ²΄ λ“±
* 2: μμ†μ„± μ–΄λ‘ν„°λ” DB μΏΌλ¦¬, λ³€κ²½μ— μ‚¬μ©ν•  μ μλ” ν•μ‹μΌλ΅ μ…λ ¥ λ¨λΈ λ§¤ν•‘
  * ex) JPA: μ…λ ¥ λ¨λΈμ„ JPA μ—”ν‹°ν‹° κ°μ²΄λ΅ λ§¤ν•‘
  * β­ `μ…λ ¥ λ¨λΈ`μ€ μμ†μ„± μ–΄λ‘ν„° λ‚΄λ¶€κ°€ μ•„λ‹ `μ• ν”λ¦¬μΌ€μ΄μ… μ½”μ–΄`μ— μ΅΄μ¬ -> μμ†μ„± μ–΄λ‘ν„° λ‚΄λ¶€λ¥Ό λ³€κ²½ν•λ” κ²ƒμ΄ μ½”μ–΄μ— μν–¥μ„ λ―ΈμΉμ§€ μ•μ
* 3: μμ†μ„± μ–΄λ‘ν„°λ” DBμ— μΏΌλ¦¬λ¥Ό λ‚ λ¦¬κ³  κ²°κ³Όλ¥Ό λ°›μ
* 4: DB μ‘λ‹µμ„ `ν¬νΈ`μ— μ •μλ `μ¶λ ¥ λ¨λΈ`λ΅ λ§¤ν•‘
  * β­ `μ¶λ ¥ λ¨λΈ`μ€ μμ†μ„± μ–΄λ‘ν„° λ‚΄λ¶€κ°€ μ•„λ‹ `μ• ν”λ¦¬μΌ€μ΄μ… μ½”μ–΄`μ— μ΅΄μ¬
* 5: κ²°κ³Ό λ°ν™

<br>

## ν¬νΈ μΈν„°νμ΄μ¤ λ‚λ„κΈ°

#### π‘ BAD
* ν•λ‚μ μ•„μ›ƒκ³ μ‰ ν¬νΈ μΈν„°νμ΄μ¤μ— λ¨λ“  DB μ—°μ‚°μ„ λ‘ 
  * -> `λ¶ν•„μ”ν• μμ΅΄μ„±`: μ„λΉ„μ¤κ°€ λ¶ν•„μ”ν• λ©”μ„λ“μ—λ„ μμ΅΄ν•κ² λ¨
* λ¶ν•„μ”ν• μμ΅΄μ„±μ€ μ½”λ“λ¥Ό μ΄ν•΄ν•κ³  `ν…μ¤νΈν•κΈ° μ–΄λ µκ²` ν•¨

#### π‘ GOOD
* `μΈν„°νμ΄μ¤ λ¶„λ¦¬ μ›μΉ™(ISP)`: ν΄λΌμ΄μ–ΈνΈκ°€ ν•„μ”λ΅ ν•λ” λ©”μ„λ“λ§ μ•λ©΄ λλ„λ΅ νΉν™”λ μΈν„°νμ΄μ¤λ΅ λ¶„λ¦¬ν•΄μ•Ό ν•¨
* λ¶ν•„μ”ν• μμ΅΄μ„±μ„ μ¤„μ΄κ³ , κΈ°μ΅΄ μμ΅΄μ„±μ„ λμ— λ” μ λ„κ² λ§λ“¦
* `ν¬νΈμ μ΄λ¦„μ΄ ν¬νΈμ μ—­ν• μ„ λ…ν™•ν•κ² ν‘ν„`ν•κ² ν•¨

<img src="https://github.com/HYEEWON/clean-architecture-1/assets/38900338/1aa494dc-6c9c-428d-aabb-13cd2609616c" height="150px">

<br>
<br>

## μμ†μ„± μ–΄λ‘ν„° λ‚λ„κΈ°

* μμ†μ„± μ–΄λ‘ν„°λ¥Ό μ—¬λ¬ ν΄λμ¤λ΅ λ‚λ” -> λ„λ©”μΈμ κ²½κ³„λ¥Ό λ”°λΌ μμ†μ„± μ–΄λ‘ν„°κ°€ μλ™μΌλ΅ λ‚λ μ§

<img src="https://github.com/HYEEWON/clean-architecture-1/assets/38900338/dcebc3c5-0aa9-42b3-96c4-1bba00418e61" height="150px">

* μ—¬λ¬ κ°μ `Bounded Context`μ μμ†μ„± μ”κµ¬μ‚¬ν•­μ„ λ¶„λ¦¬ν•λ” κ²ƒμ μΆ‹μ€ ν† λ€κ°€ λ¨
  * κ° λ§¥λ½μ€ ν•λ‚ (μ΄μƒ)μ μμ†μ„± μ–΄λ‘ν„°λ¥Ό κ°€μ§
  * μ–΄λ–¤ λ§¥λ½μ΄ λ‹¤λ¥Έ λ§¥λ½μ— μ ‘κ·Όν•κΈ° μ„ν•΄μ„λ” μ „μ© `μΈμ»¤λ° ν¬νΈ`λ¥Ό μ΄μ©ν•΄μ•Ό ν•¨

<img src="https://github.com/HYEEWON/clean-architecture-1/assets/38900338/b420d3c5-c634-4bb3-8581-672708150a5d" height="288px">

<br>
<br>

## μ¤ν”„λ§ λ°μ΄ν„° JPA μμ 

* λ„λ©”μΈ λ¨λΈ: `Account` μ—”ν‹°ν‹°
  * μµλ€ν• λ¶λ³€μ„±μ„ μ μ§€ν•λ ¤κ³  ν•¨
  * μ ν¨μ„± κ²€μ¦ μ§„ν–‰ -> μ ν¨ν•μ§€ μ•μ€ λ„λ©”μΈ λ¨λΈ μƒμ„± λ¶κ°€
* λ°μ΄ν„°λ² μ΄μ¤ λ¨λΈ: `AccountJpaEntity`, `ActivityJpaEntity`
  * DB μƒνƒ ν‘ν„μ„ μ„ν•΄ `@Entity`, `@Table` μ• λ…Έν…μ΄μ…μ΄ μ¶”κ°€λ ν΄λμ¤
* Repository

```java
interface AccountRepository extends JpaRepository<AccountJpaEntity, Long> { }
```

```java
interface ActivityRepository extends JpaRepository<ActivityJpaEntity, Long> { }
```

* Adapter

```java
class AccountPersistenceAdapter implements LoadAccountPort, UpdateAccountStatePort { 
    private final AccountRepository accountRepository;
    private final ActivityRepository activityRepository;
}
```

* β­ `ν’λ¶€ν• λ„λ©”μΈ λ¨λΈ`μ„ μ„ν•΄ λ„λ©”μΈ λ¨λΈκ³Ό λ°μ΄ν„°λ² μ΄μ¤ λ¨λΈ μ‚¬μ΄μ μ–‘λ°©ν–¥ λ§¤ν•‘μ„ ν•λ” κ²ƒμ΄ μΆ‹μ
  * μ΄μ : λ§¤ν•‘μ„ ν•μ§€ μ•μΌλ©΄ JPAλ΅ μΈν•΄ λ„λ©”μΈ λ¨λΈμ„ νƒ€ν‘ν•  μ λ°–μ— μ—†μ 
    * JPA μ—”ν‹°ν‹°λ” κΈ°λ³Έ μƒμ„±μλ¥Ό ν•„μ”λ΅ ν•¨, @ManyToOne κ΄€κ³„ μ„¤μ • λ“±

<br>

## λ°μ΄ν„°λ² μ΄μ¤ νΈλμ­μ…μ€ μ–΄λ–»κ² ν•΄μ•Ό ν• κΉ?

* νΈλμ­μ…μ…μ€ `ν•λ‚μ νΉμ •ν• μ μ¤μΌ€μ΄μ¤μ— λ€ν•΄ μΌμ–΄λ‚λ” λ¨λ“  μ“°κΈ° μ‘μ—…`μ— κ±Έμ³ μμ–΄μ•Ό ν•¨
* μ΄ μ±…μ„μ€ μμ†μ„± μ–΄λ‘ν„° νΈμ¶μ„ κ΄€μ¥ν•λ” `μ„λΉ„μ¤`μ— μ„μ„
  * μμ†μ„± μ–΄λ‘ν„°λ” μ–΄λ–¤ μ—°μ‚°μ΄ κ°™μ€ μ μ¤μΌ€μ΄μ¤μ— ν¬ν•¨λλ”μ§€ λ¨λ¦„
* `μ• ν”λ¦¬μΌ€μ΄μ… μ„λΉ„μ¤`μ— `@Transactional` μ• λ…Έν…μ΄μ… μ‚¬μ©

```java
@Transactional
public class SendMoneyService implements SendMoneyUseCase { }
```
